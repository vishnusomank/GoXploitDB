package services

import (
	"net/http"

	"github.com/gin-gonic/gin"
	"github.com/vishnusomank/GoXploitDB/models"
)

func SearchByCVE(c *gin.Context) {

	var xploitdb []models.XploitDB

	count := models.DB.Where("cve LIKE ?", "%"+c.Param("cve")+"%").Find(&xploitdb)

	if count.Error != nil {
		c.JSON(http.StatusBadRequest, gin.H{"Error": "Record not found!"})
		return

	}

	for i := 0; i < int(count.RowsAffected); i++ {
		c.IndentedJSON(http.StatusOK, gin.H{"ID": xploitdb[i].ID, "TITLE": xploitdb[i].Title, "URL": xploitdb[i].URL, "CVE": xploitdb[i].CVE, "AUTHOR": xploitdb[i].Author})
		c.String(200, "\n")

	}
	c.JSON(http.StatusOK, gin.H{"Total Records": int(count.RowsAffected)})
	c.String(200, "\n")

}
